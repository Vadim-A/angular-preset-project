# Angular Preset Project

Данное приложение angular спроектировано и настроено с учетом накопленного опыта в проектировании и лучших практик программирования. Служит для быстрого развертывания проектов на старте разработки и быстрого внедрения содрудников в процесс разработки и следованию общих архитектурных принципов.

**_todo: подумать над формулировкой_**

## Дополнительно установленные зависимости

`normalize.css` - CSS-файл, который обеспечивает для HTML-элементов кроссбраузерность в стилях по умолчанию.

`jwt-decode` - Для работы с jwt токеном.

### Dev зависимости

`Jest` - инструмент для unit тестирования, так же установлен пакет `jest-preset-angular` с предустановленными настройками для angular.

`eslint` - инструмент статического анализа кода для выявления проблемных шаблонов. Для полноценной работы установленны плагины и конфиги:

- `@angular-eslint` - набор пакетов для работы **ESLint** в среде angular
- `@typescript-eslint` - набор пакетов для работы **ESLint** c typescript синтаксисом
- `eslint-plugin-import` - плагин, который следить за тем, чтобы все импортируемые зависимости присутствовали в проекте, подключались в удобном для последующей работы порядке, и так далее
- `eslint-plugin-jest` - плагин, позволяющий настроить правила анализа кода для тестов
- `eslint-plugin-jest-formatting` - плагин, позволяющий настроить правила форматирования для тестов
- `eslint-plugin-prettier` - плагин для форматирования кода
- `eslint-config-airbnb-typescript` - предустановленая конфигурация правил анализа кода typescript
- `eslint-config-prettier` - предустановленные правила для форматирования кода

Более подробно о **ESLint** можно ознакомится на оффициальном сайте [https://eslint.org/docs/user-guide/getting-started](https://eslint.org/docs/user-guide/getting-started). Подробное описание списка доступных плагинов и конфигураций доступно здесь [https://github.com/dustinspecker/awesome-eslint](https://github.com/dustinspecker/awesome-eslint).

`stylelint` - инструмент статического анализа кода стилей, который отлавливает ошибки и помогает соблюдать соглашения по стилю кода и применяемым практикам. Для полноценной работы установленны плагины и конфигурации:

- `stylelint-scss` - плагин для работы с _.scss_ файлами
- `stylelint-prettier` - плагин для форматирования кода
- `stylelint-config-standard`, `stylelint-config-recommended-scss` - предустановленные конфигурации для _.scss_

Более подробно о **stylelint** можно ознакомится на оффициальном сайте [https://stylelint.io/user-guide/get-started](https://stylelint.io/user-guide/get-started).

`prettier` - отдельный инструмен для форматирования кода.

`husky` - инструмент, позволяющий описать хуки для git.

`lint-staged` - инструмент, позволяющий запускать линтеры для файлов, находящиеся в состоянии staged.

`commitizen` - инструмент для запуска интерактивного режима коммитов для соблюдения соглашений. `cz-conventional-changelog` - для настройки `commitizen`.

`@commitlint` - набор инструментов для обнаружения отклонений от настроек соглашений о коммитах в момент коммита.

`standard-version` - инструмент для автоматической генерации CHANGELOG.md и версии приложения на основе коммитов.

## Команды проекта

- `start`: запуск проекта.
- `build`: сборка проекта.
- `build:prod`: сборка проекта в режиме prod (с оптимизацией и без source map).
- `test`: прогон тестов.
- `test:watch`: запуск механизма отслеживание изменений для автоматической прогонки тестов.
- `test:coverage`: расчет покрытия кода тестами.
- `e2e`: запуск e2e тестирования.
- `lint`: вывод ошибок линтера для _.ts_ и _.html_ файлов.
- `lint:fix`: вывод ошибок линтера и автоматическое исправление для _.ts_ и _.html_ файлов.
- `stylelint`: вывод ошибок линтера для _.scss_ файлов.
- `stylelint`: вывод ошибок линтера и автоматическое исправление для _.scss_ файлов.
- `stylelint`: инструмент для форматирование кода для _.ts_ и _.html_ файлов.
- `lint-staged`: команда для прогонки линтеров для staged файлов. Автоматически запускает работу пакетов `prettier` и `stylelint` перед коммитом.
- `cz`: запуск интерактивного режима создания коммитов согласно принятым правилам.
- `release`: автоматическая генерация CHANGELOG.md.

## Структура проекта

- `components` - каталог для компонент, которые используются только на главной странице и таким образом отображаются на всем приложении (например компоненты главного меню, лодера, футера, сайд-бара и т.д.).
- `core` содержит в себе фундамент работы приложения, который используется повсеместно (например сервисы авторизации и получения данных, гуарды и т.д.) а так же необходимые интерфейсы и константы.
- `store` - стор для приложения.
- `modules` - каталог для хранения отдельных независимых друг от друга модулей приложения, как правило лениво подгружаемых.
- `shared` - содержит общие программные элементы, которые могут быть использованы в произвольном месте приложения. Включают в себя:
  - `modules`:
    - `pure` - компоненты, являющиеся частью UI, содержат минимальный код, необходимый для обслуживания поведения UI. Могут инджектить встроеные в ангулар сервисы (ChangeDetectorRef, FormBuilder). Могут содержать внутри себя другие pure-компоненты. Не могут влиять на внешнее окружение и знать о нем. Могут быть легко портированы в другой проект. Могут базироваться на стороних UI библиотеках (ui-kit, material, kendo и тд).
    - `smart` - комплексные компоненты, Которые могут содержать в себе другие **smart** или **pure** компоненты. Могут инджектить сервисы (сервисы-хелперы), описанные отдельно в проекте в shared. Могут иметь доступ к внешниму окружению и влиять на него через стор или сервисы, (например, **smart** компонент грид подписался на нажатие кнопки изменения высоты в тулбаре, либо тулбар сигнализирует внешнему окружению о нажатии на какую-либо кнопку через стор или общий сервис).
    - `feature` - содержат бизнес-логику приложения используемую в разных местах. может инджектить любые сервисы, описанные в shared, может обращаться к бэк-энду. Может иметь свой стор.
  - `services` - сервисы для инкапсуляции бизнес-логики
  - `validators` - общие валидаторы для реактивных форм.
  - `utils` - вспомогательные функции
  - `pipes`
  - `directives`
  - `models`
  - `constants`

## Работа с Git (**_todo_**)

При написании коммита нужно придерживаться общепринятых соглашений [https://www.conventionalcommits.org/ru/v1.0.0-beta.4/](https://www.conventionalcommits.org/ru/v1.0.0-beta.4/). Можно воспользоваться командой для интерактивного ввода сообщений о коммите `npm run cz`. На основе этих комитов в дальнейшем генерируется файл CHANGELOG.md

Для автоматической генерации CHANGELOG.md и версии приложения нужно запустить комманду `npm run release`. Команда автоматически создаст новый коммит с измененными CHANGELOG.md, package.json и package-lock.json.

Подробнее о пакете `standard-version` можно ознакомится по ссылке [https://github.com/conventional-changelog/standard-version](https://github.com/conventional-changelog/standard-version)

> **!** При выполнении команды `npm run release` в git будут созданы теги.

> **!** Первый запуск генерации CHANGELOG.md рекомендуется делать с параметром `first-release` что бы не повышать версию приложения: `npm run release -- --first-release`.

## Настройка рабочего места

Для работы на рабочем месте должны быть установленны:

- [node.js (LTS)](https://nodejs.org/en/)
- [docker](https://hub.docker.com/search?offering=community&type=edition) (для запуска докер-контейнеров)

Для удобной работы рекомендуется установить следующие плагины для IDE:

- VS Code:
  - [Angular Language Service](https://marketplace.visualstudio.com/items?itemName=Angular.ng-template)
  - [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)
  - [GitLens — Git supercharged](https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens)
  - [Prettier - Code formatter](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode)
  - [vscode-angular-html](https://marketplace.visualstudio.com/items?itemName=ghaschel.vscode-angular-html)
  - [Docker](https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker)

## Использование docker

Для запуска приложения в контейнере, необходимо что бы на рабочем месте был установлен [Docker](https://hub.docker.com/search?offering=community&type=edition).

В проекте описан **Dockerfile** для сборки и хостинга приложения в контейнере с nginx. Для запуска контейнера необходимо ввести команду:

> `docker build -t ng:v1 .`

По умолчанию проект собирается в режиме **production**. Что бы собрать проект в режиме **development**, нужно указать пустой параметр **configuration**:

> docker build -t ng:v1 . --build-arg configuration=

Так же можно запускать несколько контейнеров. описание запуска находится в файле **docker-compose.yml**. Для запуска необходимо ввести команду:

> docker-compose up --build -d

Кроме этого, можно вести разработку локально и отлаживать в контейнере. Для этого нужно запустить компиляцию приложения в режиме watch и затем запустить контейнер:

> npm run build:watch
>
> docker-compose -f docker-compose-debug.yml up --build -d

## Рекомендации разработчикам (todo)

- В качестве главного компонента модуля используте название [module-name]-main.
- Используйте "технический радар" при выборе необходимых библиотек.
- Для ведения документации по проекту используйте директорию docs.
- Вносите архитектурные решения проекта в директорию `adr` (**Architectural Decision Records**).
- В случае необходимости обсудить решение какой-либо проблемы с командой, используйте директорию `rfc` (**Request for Comments**).
